<html>
  <head>
    <title>Roorkee Sale Invoice</title>
    <script src="/static/lib/angular/angular.min.js"></script>
    <script src="/static/lib/angular/angular-resource.min.js"></script>
    <script src="/static/js/services.js"></script>
    <script src="/static/js/script.js"></script>

    <!-- Standard Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico" />

    <!-- For iPhone 4 Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/static/img/sew114.png">

    <!-- For iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/static/img/sew72.png">

    <!-- For iPhone: -->
    <link rel="apple-touch-icon-precomposed" href="/static/img/sew57.png">

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=yes">
    <link rel="stylesheet" href="/static/css/bootstrap.min.css" type="text/css" >
    <link rel="stylesheet" href="/static/css/bs_modified.css" type="text/css" >
    <script>
      var appMod = angular.module('SEWPulseApp', ['bomServices']);
      appMod.config(function($interpolateProvider) {
        $interpolateProvider.startSymbol('||');
        $interpolateProvider.endSymbol('||');
      });

      var debug;
      debug = false;
      debug = true;

      appMod.controller('RRKSaleInvoiceCtrl', ['$scope', 'Model', 'RRKSaleInvoice', function($scope, Model, RRKSaleInvoice) {

        function FetchModelsFromServer() {
          $scope.statusNote = "Fetching model set...";
          Model.query(function(data){
            $scope.models = data;
            console.log("Models: " + $scope.models);
            if($scope.models.length === 0) {
              $scope.models[0] = "No model exists. Please create one.";
            }
            }, function(error){
            $scope.statusNote = error.status + ": " + error.data;
          });
        }

        function FetchInvoiceWithIDInAddressBar() {
          $scope.statusNote = "Fetching RRK Sale Invoice ...";
          $scope.invoiceIDFromAddBar = document.location.href.split('/').pop();
          RRKSaleInvoice.get({id: $scope.invoiceIDFromAddBar}, function(data){
            $scope.statusNote = "";
            $scope.si = data;
            }, function(error){
            $scope.statusNote = error.status + ": " + error.data;
          });
        }
        $scope.siProperties =[
        {
          Name:'Customer',
          Editable:false,
          id:'CustomerName'
        },
        {
          Name:'Invoice',
          Editable:false,
          id:'Number'
        },
        {
          Name:'Date',
          Editable:false,
          id:'DD_MMM_YY'
        },
        ]
        $scope.siLowerProperties =[
        {
          Name:'Goods Value',
          Editable:false,
          id:'GoodsValue'
        },
        {
          Name:'Total Tax',
          Editable:false,
          id:'TotalTax'
        },
        {
          Name:'Total Freight',
          Editable:false,
          id:'TotalFreight'
        },
        {
          Name:'Grand Total',
          Editable:false,
          id:'GrandTotal'
        },
        {
          Name:'Remarks',
          Editable:false,
          id:'Remarks'
        },
        ]

        $scope.deleteInvoice = function() {
          $scope.statusNote = "Deleting invoice on server...";
          RRKSaleInvoice.remove({id:$scope.invoiceIDFromAddBar}, function(data){
            $scope.statusNote = "Invoice deleted...";
            $scope.invoiceDeleted = true;
            }, function(error){
            $scope.statusNote = error.status + ": " + error.data;
          });
        }

        FetchModelsFromServer();
        FetchInvoiceWithIDInAddressBar();
      }]);
    </script>
  </head>

  <body ng-app="SEWPulseApp" ng-controller="RRKSaleInvoiceCtrl">
    <div class="well">
      <a href="/"><img class="center-block" src="/static/img/sew57.png" /></a>
      <h1 class="text-center">RRK Sale Invoice</h1>
      <div id="statusNote" ng-bind="statusNote"></div>
    </div>
    <div class="container-fluid">
      <div ng-show="invoiceDeleted">
        <div class="alert alert-success" role="alert">
          <div class="text-center">
            Invoice has been deleted successfully.
          </div>
        </div>
      </div>
      <div ng-hide="invoiceDeleted">
        <div class="panel panel-info">
          <div class="panel-heading">
            <strong>||si.CustomerName||</strong>
          </div>
          <div class="panel-content">
            <table class="table">
              <tr ng-repeat="obj in siProperties">
                <td><span ng-bind="obj['Name']"></span></td>
                <td><input ng-readonly="!obj['Editable']" class="form-control" ng-model="si[obj['id']]"></input></td>
              </tr>
              <tr ng-repeat="obj in siLowerProperties">
                <td><span ng-bind="obj['Name']"></span></td>
                <td><input ng-readonly="!obj['Editable']" class="form-control" ng-model="si[obj['id']]"></input></td>
              </tr>
              <tr ng-repeat="item in si.Items">
                <td><span ng-bind="si.Items[$index].Name"></span></td>
                <td>
                  <span ng-bind="si.Items[$index].Quantity"></span>pc
                  @&#8377;<span ng-bind="si.Items[$index].Rate"></span>
                </td>
              </tr>
            </table>
          </div>
        </div>
        <div ng-hide=hideDelete>
          <div ng-hide="stage2">
            <button class="btn btn-xs btn-danger" ng-click="stage2=true">Delete Invoice</button>
          </div>
          <div ng-show="stage2">
            <button class="btn btn-xs btn-danger pull-right" ng-click="deleteInvoice();stage2=false">Confirm deletion of invoice#||si.Number||</button>
          </div>
        </div>
      </div>
      <div class="todo">Hide intermittent stuff. Display when loading finished.</div>
    </div> <!-- container -->
  </body>
</html>
