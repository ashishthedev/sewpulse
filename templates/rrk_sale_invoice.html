<html>
  <head>
    <title>Roorkee Sale Invoice</title>
    <script src="/static/lib/angular/angular.min.js"></script>
    <script src="/static/lib/angular/angular-resource.min.js"></script>
    <script src="/static/js/services.js"></script>
    <script src="/static/js/script.js"></script>

    <!-- Standard Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico" />

    <!-- For iPhone 4 Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/static/img/sew114.png">

    <!-- For iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/static/img/sew72.png">

    <!-- For iPhone: -->
    <link rel="apple-touch-icon-precomposed" href="/static/img/sew57.png">

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=yes">
    <link rel="stylesheet" href="/static/css/bootstrap.min.css" type="text/css" >
    <link rel="stylesheet" href="/static/css/bs_modified.css" type="text/css" >
    <script>
      var appMod = angular.module('SEWPulseApp', ['bomServices']);
      appMod.config(function($interpolateProvider) {
        $interpolateProvider.startSymbol('||');
        $interpolateProvider.endSymbol('||');
      });

      var debug;
      debug = false;
      debug = true;

      appMod.controller('RRKSaleInvoiceCtrl', ['$scope', 'Model', 'RRKSaleInvoice', function($scope, Model, RRKSaleInvoice) {

        function FetchModelsFromServer() {
          $scope.statusNote = "Fetching model set...";
          Model.query(function(data){
            $scope.models = data;
            console.log("Models: " + $scope.models);
            if($scope.models.length === 0) {
              $scope.models[0] = "No model exists. Please create one.";
            }
            }, function(error){
            $scope.statusNote = error.status + ": " + error.data;
          });
        }

        function FetchInvoiceWithIDInAddressBar() {
          $scope.statusNote = "Fetching RRK Sale Invoice ...";
          $scope.invoiceIDFromAddBar = document.location.href.split('/').pop();
          RRKSaleInvoice.get({id: $scope.invoiceIDFromAddBar}, function(data){
            $scope.statusNote = "";
            $scope.si = data;
            }, function(error){
            $scope.statusNote = error.status + ": " + error.data;
          });
        }
        $scope.siProperties =[
        {
          Name:'Customer',
          Editable:false,
          id:'CustomerName'
        },
        {
          Name:'Invoice',
          Editable:false,
          id:'Number'
        },
        {
          Name:'Date',
          Editable:false,
          id:'DD_MMM_YY'
        },
        {
          Name:'Total Tax',
          Editable:true,
          id:'TotalTax'
        },
        {
          Name:'Total Freight',
          Editable:true,
          id:'TotalFreight'
        },
        {
          Name:'Remarks',
          Editable:true,
          id:'Remarks'
        },
        ]

        FetchModelsFromServer();
        FetchInvoiceWithIDInAddressBar();
      }]);
    </script>
  </head>

  <body ng-app="SEWPulseApp" ng-controller="RRKSaleInvoiceCtrl">
    <div class="well">
      <a href="/"><img class="center-block" src="/static/img/sew57.png" /></a>
      <h1 class="text-center">RRK Sale Invoice</h1>
      <div id="statusNote" ng-bind="statusNote"></div>
    </div>
    <div class="container-fluid">
      <div class="panel panel-info">
        <div class="panel-heading">
          <strong>||si.CustomerName||</strong>
        </div>
        <div class="panel-content">
          <table class="table">
            <tr ng-repeat="obj in siProperties">
              <td><span ng-bind="obj['Name']"></span></td>
              <td><input ng-readonly="!obj['Editable']" class="form-control" ng-model="si[obj['id']]"></input></td>
            </tr>
            <tr ng-repeat="item in si.Items">
              <td><select>
                <option ng-repeat="(k, m) in models" ng-selected="m.Name == item.Name">
                ||k||
                </option>
            </select>
          </td>
                <!--
              <td><select ng-options="m for (m, model) in models" ng-model="si['Items'][$index]['Name']"></select></td>
              -->
              <td><input ng-model="si['Items'][$index]['Rate']"></select></td>
            </tr>
          </table>
        </div>
      </div>
    </div> <!-- container -->
  </body>
</html>
