<html>
  <head>
    <title>Roorkee Stock Position</title>
    <script src="/static/lib/angular/angular.min.js"></script>
    <script src="/static/lib/angular/angular-resource.min.js"></script>
    <script src="/static/js/services.js"></script>
    <script src="/static/js/script.js"></script>

    <!-- Standard Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico" />

    <!-- For iPhone 4 Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/static/img/sew114.png">

    <!-- For iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/static/img/sew72.png">

    <!-- For iPhone: -->
    <link rel="apple-touch-icon-precomposed" href="/static/img/sew57.png">

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=yes">
    <link rel="stylesheet" href="/static/css/bootstrap.min.css" type="text/css" >
    <link rel="stylesheet" href="/static/css/bs_modified.css" type="text/css" >
    <script>
      var appMod = angular.module('SEWPulseApp', ['bomServices']);
      appMod.config(function($interpolateProvider) {
        $interpolateProvider.startSymbol('||');
        $interpolateProvider.endSymbol('||');
      });

      appMod.controller('RRKStockPositionController', ['$scope', '$http', 'RRKStockPosition', 'RRKStockPristineDate', function($scope, $http, RRKStockPosition, RRKStockPristineDate) {

        function FetchRRKStockPristineDate(){
          RRKStockPristineDate.get(function(data){
            $scope.stockPristineDate = DateAsUnixTimeToDDMMMYY(data.PristineTime);
            $scope.statusNote = "";
            }, function(error){
            $scope.statusNote = error.status + ": " + error.data;
          });
        }

        $scope.FetchRRKStockPositionFromServer = function() {
          $scope.working = true;
          $scope.stockAvailable = false;
          $scope.statusNote = "Fetching stock position ...";
          RRKStockPosition.get({id:JSDateToUnixTime($scope.JSDate)}, function(data){
            $scope.Models = data.ModelQtyMap;
            $scope.Articles = data.ArticleQtyMap;
            FetchRRKStockPristineDate();
            $scope.statusNote = "";
            $scope.working = false;
            $scope.stockAvailable = true;
            }, function(error){
            $scope.statusNote = error.status + ": " + error.data;
            $scope.stockAvailable = false;
            $scope.working = false;
          });
        }

        $scope.DateChanged = function(){
          var today = new Date();
          if (today < $scope.JSDate) {
            $scope.JSDate = today;
          }
          $scope.requestedStockOnDateDDMMYY = DDMMMYYFromUnixTime(JSDateToUnixTime($scope.JSDate));
          $scope.dateDiffFromTodayAsText = GetDateDiffAsText($scope.JSDate);
        }

        $scope.JSDate = new Date();
        $scope.DateChanged();
        $scope.statusNote = "";
        $scope.todayDDMMYY = DDMMMYYFromUnixTime(JSDateToUnixTime(new Date()));
        FetchRRKStockPristineDate();
      }]);
    </script>
  </head>
  <body ng-app="SEWPulseApp" ng-controller="RRKStockPositionController">
    <div class="well">
      <a class="hidden-print" href="/"><img class="center-block" src="/static/img/sew57.png" /></a>
      <h2 class="text-center">RRK Stock Position</h2>
      <div class="text-center hidden-print" ng-show="stockPristineDate"> Digested stock available upto: <span id="result" ng-bind="stockPristineDate"></span></div>
      <div class="text-center visible-print"><big><span id="result" ng-bind="requestedStockOnDateDDMMYY"></span></big></div>
      <div class="pull-right visible-print"> <small>Printed on <span ng-bind="todayDDMMYY"></span></small> </div>
      <div id="statusNote" ng-bind="statusNote"></div>
    </div>
    <div class="container-fluid">
      <div class="row hidden-print">
        <span class="col-xs-offset-3 col-xs-6 col-sm-offset-4 col-sm-4 col-lg-offset-5 col-lg-2">
          <div class="input-group">
            <input required class="center-block form-control" autofocus="true" title="View Stock for this date" type="date" ng-model="JSDate" ng-change="DateChanged()" />
            <span class="input-group-btn">
              <button class="btn btn-info" ng-disabled="working" type="button" ng-click="FetchRRKStockPositionFromServer()">Go!</button>
            </span>
          </div><!-- /input-group -->
        </span>
      </div>
      <hr class="hidden-print">
      <div ng-show="working">
        <img class="center-block" src="/static/img/working.gif" />
      </div>

      <div ng-show="!working">
        <div ng-show="stockAvailable">
          <table class="table table-striped table-condensed">
            <thead>
              <tr>
                <th class="col-xs-3" >Model</th>
                <th>Quantity</th>
              </tr>
            </thead>
            <tr ng-repeat="(modelName, quantity) in Models">
              <td class="hidden-print"><span ng-bind="modelName"></span></td>
              <td class="visible-print"><small><span ng-bind="modelName"></small></span></td>
              <td class="hidden-print"> <a ng-href="/trace/model/||modelName||"><span ng-bind="quantity"></span></a> </td>
              <td class="visible-print"> <small><span ng-bind="quantity"></span></small></td>
            </tr>
          </table>
          <table class="table table-striped table-condensed">
            <thead>
              <tr>
                <th class="col-xs-3">Article</th>
                <th>Quantity</th>
              </tr>
            </thead>
            <tr ng-repeat="(name, quantity) in Articles">
              <td class="hidden-print"><span ng-bind="name"></span></td>
              <td class="visible-print"><small><span ng-bind="name"></span></small></td>
              <td class="hidden-print"> <a ng-href="/trace/article/||name||"><span ng-bind="quantity"></span></a> </td>
              <td class="visible-print"> <small><span ng-bind="quantity"></span></small></td>
            </tr>
          </table>
        </div><!-- stockAvailable -->
      </div> <!-- !working -->
    </div> <!-- container -->
  </body>
</html>
